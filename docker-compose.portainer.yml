version: "3.8"

services:
  agente-campanhas:
    image: ghcr.io/cardosolucass96/agente-de-campanhas:latest
    container_name: agente-campanhas
    restart: unless-stopped
    
    networks:
      - CardosoNet

    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - FACEBOOK_ACCESS_TOKEN=${FACEBOOK_ACCESS_TOKEN}
      - FACEBOOK_APP_ID=${FACEBOOK_APP_ID}
      - FACEBOOK_APP_SECRET=${FACEBOOK_APP_SECRET}
      - WHATSAPP_PHONE_NUMBER_ID=${WHATSAPP_PHONE_NUMBER_ID}
      - WHATSAPP_BUSINESS_ACCOUNT_ID=${WHATSAPP_BUSINESS_ACCOUNT_ID}
      - WHATSAPP_ACCESS_TOKEN=${WHATSAPP_ACCESS_TOKEN}
      - WHATSAPP_WEBHOOK_VERIFY_TOKEN=${WHATSAPP_WEBHOOK_VERIFY_TOKEN}
      - WHATSAPP_APP_SECRET=${WHATSAPP_APP_SECRET}
      - EVOLUTION_API_URL=${EVOLUTION_API_URL}
      - EVOLUTION_API_KEY=${EVOLUTION_API_KEY}
      - EVOLUTION_INSTANCE=${EVOLUTION_INSTANCE}
      - WHATSAPP_PROVIDER=${WHATSAPP_PROVIDER:-evolution}
      - DATABASE_URL=sqlite:////app/data/agente_campanhas.db
      - TZ=America/Sao_Paulo

    volumes:
      - agente_campanhas_data:/app/data

    labels:
      - traefik.enable=true
      - traefik.http.routers.agente_campanhas.rule=Host(`agente.cardosolucas.com`)
      - traefik.http.routers.agente_campanhas.entrypoints=websecure
      - traefik.http.routers.agente_campanhas.tls.certresolver=letsencryptresolver
      - traefik.http.services.agente_campanhas.loadbalancer.server.port=8000

volumes:
  agente_campanhas_data:
    driver: local

networks:
  CardosoNet:
    external: true
